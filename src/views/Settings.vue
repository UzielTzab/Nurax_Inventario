<template>
  <DashboardLayout>
    <div class="settings-wrapper">
      <div class="settings-inner">
        
        <!-- Header -->
        <div class="page-header">
          <div>
            <h1 class="page-title">Configuraci√≥n del Negocio</h1>
            <p class="page-subtitle">Administra la identidad de tu tienda y personaliza la experiencia de tus clientes en los recibos.</p>
          </div>
          <div class="header-actions">
            <AppButton variant="fill" @click="saveSettings" :loading="isSaving">
              Guardar Cambios
            </AppButton>
          </div>
        </div>

        <div class="settings-grid">
          
          <!-- LEFT COLUMN: FORMS -->
          <div class="settings-forms">
            
            <!-- SECTION 1: Informaci√≥n General -->
            <div class="settings-card">
              <div class="card-header">
                <HomeModernIcon class="home-icon-style"/>
                <h2>Informaci√≥n General</h2>
              </div>

              <div class="form-grid">
                <!-- Nombre del negocio -->
                <div class="input-group">
                  <AppInput
                    v-model="settings.storeName"
                    label="Nombre del Negocio"
                    placeholder="Escribe el nombre de tu negocio"
                  />
                </div>

                <!-- Simbolo de moneda -->
                <div class="input-group">
                  <label>S√≠mbolo de Moneda</label>
                  <div class="select-wrapper">
                    <select v-model="settings.currency">
                      <option value="$ MXN">$ MXN (Peso Mexicano)</option>
                      <option value="$ USD">$ USD (D√≥lar Estadounidense)</option>
                      <option value="‚Ç¨ EUR">‚Ç¨ EUR (Euro)</option>
                    </select>
                    <svg class="chevron" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
                    </svg>
                  </div>
                </div>

                <!-- Direcci√≥n F√≠sica -->
                <div class="input-group full-width">
                  <AppInput
                    v-model="settings.address"
                    label="Direcci√≥n F√≠sica"
                    placeholder="Ej. Av. Reforma 123, Col. Centro, CDMX"
                  />
                </div>

                <!-- WhatsApp de Contacto -->
                <div class="input-group full-width">
                  <label>WhatsApp de Contacto</label>
                  <div class="phone-input-group">
                    <div class="select-wrapper country-code">
                      <select v-model="settings.countryCode">
                        <option value="+52">+52</option>
                        <option value="+1">+1</option>
                        <option value="+34">+34</option>
                      </select>
                      <svg class="chevron" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
                      </svg>
                    </div>
                    <div class="phone-number-field">
                      <AppInput
                        v-model="settings.phone"
                        type="tel"
                        placeholder="55 9876 5432"
                      />
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- SECTION 2: Personalizaci√≥n del Ticket -->
            <div class="settings-card">
              <div class="card-header">
                <div class="icon-box brand">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25A3.375 3.375 0 0 0 4.875 5.625v12.75a3.375 3.375 0 0 0 3.375 3.375h9.75a3.375 3.375 0 0 0 3.375-3.375v-1.5zm0 0v1.5a2.25 2.25 0 0 1-2.25 2.25h-9.75a2.25 2.25 0 0 1-2.25-2.25V5.625a2.25 2.25 0 0 1 2.25-2.25h1.875v1.5c0 1.243 1.007 2.25 2.25 2.25h1.5a2.25 2.25 0 0 1 2.25 2.25v2.625m0 0h1.5a2.25 2.25 0 0 1 2.25 2.25v1.5a2.25 2.25 0 0 1-2.25 2.25H21v-2.625z" v-if="false" />
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 0 0 2.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 0 0-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75 2.25 2.25 0 0 0-.1-.664m-5.8 0A2.251 2.251 0 0 1 13.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25ZM6.75 12h.008v.008H6.75V12Zm0 3h.008v.008H6.75V15Zm0 3h.008v.008H6.75V18Z" />
                  </svg>
                </div>
                <h2>Personalizaci√≥n del Ticket</h2>
              </div>

              <div class="form-grid">
                <!-- Dropzone de logo -->
                <div class="input-group">
                  <label>Logo para el Ticket</label>
                  <!-- Hidden real file input -->
                  <input
                    ref="logoInputRef"
                    type="file"
                    accept="image/png,image/jpeg,image/webp"
                    style="display:none"
                    @change="onLogoFile"
                  />
                  <!-- Dropzone visual -->
                  <div
                    class="dropzone"
                    :class="{ 'dropzone-has-image': settings.logoUrl }"
                    @click="logoInputRef?.click()"
                    @dragover.prevent
                    @drop.prevent="onLogoDrop"
                  >
                    <!-- Preview if image selected -->
                    <template v-if="settings.logoUrl">
                      <img :src="settings.logoUrl" class="dropzone-preview" alt="Logo preview" />
                      <button class="dropzone-remove" @click.stop="settings.logoUrl = ''" title="Quitar logo">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M6.28 5.22a.75.75 0 0 0-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 1 0 1.06 1.06L10 11.06l3.72 3.72a.75.75 0 1 0 1.06-1.06L11.06 10l3.72-3.72a.75.75 0 0 0-1.06-1.06L10 8.94 6.28 5.22Z"/></svg>
                      </button>
                    </template>
                    <!-- Empty state -->
                    <template v-else>
                      <div class="dropzone-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M12 16.5V9.75m0 0 3 3m-3-3-3 3M6.75 19.5a4.5 4.5 0 0 1-1.41-8.775 5.25 5.25 0 0 1 10.233-2.33 3 3 0 0 1 3.758 3.848A3.752 3.752 0 0 1 18 19.5H6.75Z" />
                        </svg>
                      </div>
                      <p class="dropzone-text">Haz clic o arrastra tu logo</p>
                      <span class="dropzone-hint">PNG, JPG, WebP ¬∑ M√°x. 2 MB</span>
                    </template>
                  </div>
                </div>

                <!-- Mensaje final -->
                <div class="input-group">
                  <label>Mensaje de Agradecimiento</label>
                  <textarea 
                    v-model="settings.thankYouMessage" 
                    placeholder="Ej. ¬°Gracias por su preferencia!"
                    rows="4"
                  ></textarea>
                </div>

                <!-- Tama√±o de papel para impresi√≥n -->
                <div class="input-group full-width">
                  <label>Formato de Papel para Impresi√≥n</label>
                  <div class="paper-size-options">
                    <label
                      v-for="opt in paperSizeOptions"
                      :key="opt.value"
                      class="paper-size-btn"
                      :class="{ 'selected': paperWidth === opt.value }"
                    >
                      <input
                        type="radio"
                        name="paperSize"
                        :value="opt.value"
                        v-model="paperWidth"
                        style="display:none"
                        @change="onPaperWidthChange"
                      />
                      <span class="paper-icon">üñ®Ô∏è</span>
                      <span class="paper-label"> {{ opt.label }}</span>
                      <span class="paper-desc"> {{ opt.desc }}</span>
                    </label>
                  </div>
                </div>
              </div>
            </div>

          </div>

          <!-- RIGHT COLUMN: PREVIEW -->
          <div class="settings-preview">
            <div class="preview-card">
              <div class="preview-header">
                <div class="preview-title">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="text-green-600">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z" />
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                  </svg>
                  <span>Vista Previa</span>
                </div>
                <span class="preview-badge">TICKET</span>
              </div>

              <!-- Ticket Simulation -->
              <div class="ticket-simulation">
                <div class="ticket-header">
                  <!-- Show uploaded logo or fallback letter -->
                  <div class="ticket-logo" :class="{ 'ticket-logo-img': settings.logoUrl }">
                    <img v-if="settings.logoUrl" :src="settings.logoUrl" alt="Logo" />
                    <span v-else>{{ settings.storeName ? settings.storeName.charAt(0).toUpperCase() : 'N' }}</span>
                  </div>
                  <h3 class="ticket-store-name">{{ settings.storeName || 'Nombre de la Tienda' }}</h3>
                  <div class="ticket-address">
                    <p>{{ formattedAddressLines[0] || 'Direcci√≥n de la Tienda' }}</p>
                    <p v-if="formattedAddressLines[1]">{{ formattedAddressLines[1] }}</p>
                    <p>Tel: {{ settings.phone || '00 0000 0000' }}</p>
                  </div>
                </div>

                <div class="ticket-divider"></div>

                <div class="ticket-table">
                  <div class="ticket-th">
                    <span class="left-col">CANT. ARTICULO</span>
                    <span class="right-col">TOTAL</span>
                  </div>
                  <div class="ticket-tr">
                    <span class="left-col">1x Cappuccino Grande</span>
                    <span class="right-col">$65.00</span>
                  </div>
                  <div class="ticket-tr">
                    <span class="left-col">2x Galleta Avena</span>
                    <span class="right-col">$40.00</span>
                  </div>
                  <div class="ticket-tr">
                    <span class="left-col">1x Sandwich Pavo</span>
                    <span class="right-col">$85.00</span>
                  </div>
                </div>

                <div class="ticket-divider"></div>

                <div class="ticket-total-section">
                  <div class="ticket-total-row">
                    <span>TOTAL</span>
                    <span>$190.00</span>
                  </div>
                  <div class="ticket-subInfo">
                    <span>Efectivo</span>
                    <span>$200.00</span>
                  </div>
                  <div class="ticket-subInfo">
                    <span>Cambio</span>
                    <span>$10.00</span>
                  </div>
                </div>

                <div class="ticket-footer">
                  <p class="ticket-thank-you">
                    "{{ settings.thankYouMessage || '¬°Gracias por su compra!' }}"
                  </p>
                  <p class="ticket-number">NO. TICKET #004592</p>
                  <!-- Mock Barcode -->
                  <div class="ticket-barcode">
                    <svg viewBox="0 0 200 40" preserveAspectRatio="none">
                      <rect x="10" y="0" width="10" height="40" fill="#333" />
                      <rect x="25" y="0" width="5" height="40" fill="#333" />
                      <rect x="35" y="0" width="15" height="40" fill="#333" />
                      <rect x="55" y="0" width="5" height="40" fill="#333" />
                      <rect x="65" y="0" width="20" height="40" fill="#333" />
                      <rect x="90" y="0" width="8" height="40" fill="#333" />
                      <rect x="102" y="0" width="4" height="40" fill="#333" />
                      <rect x="110" y="0" width="12" height="40" fill="#333" />
                      <rect x="126" y="0" width="5" height="40" fill="#333" />
                      <rect x="135" y="0" width="15" height="40" fill="#333" />
                      <rect x="155" y="0" width="8" height="40" fill="#333" />
                      <rect x="168" y="0" width="5" height="40" fill="#333" />
                      <rect x="178" y="0" width="12" height="40" fill="#333" />
                    </svg>
                  </div>
                </div>
              </div>

              <div class="preview-footer-note">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z" />
                </svg>
                La vista previa es aproximada.
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </DashboardLayout>
</template>

<script setup lang="ts">
import { ref, computed, onMounted } from 'vue';
import DashboardLayout from '@/components/layout/DashboardLayout.vue';
import AppButton from '@/components/ui/AppButton.vue';
import AppInput from '@/components/ui/AppInput.vue';
import { useSnackbar } from '@/composables/useSnackbar';
import { HomeModernIcon } from '@heroicons/vue/24/outline';
import apiClient from '@/services/api';
import { getStoredPaperWidth, savePaperWidth, type PaperWidth } from '@/utils/ticketBuilder';

const { enqueueSnackbar } = useSnackbar();

// Ref for the hidden file input and selected logo file
const logoInputRef = ref<HTMLInputElement | null>(null);
const logoFile = ref<File | null>(null);

// Form Data ‚Äî populated from backend on mount
const settings = ref({
  storeName: '',
  currency: '$ MXN',
  address: '',
  countryCode: '+52',
  phone: '',
  thankYouMessage: '',
  logoUrl: '' as string,
});

// ‚îÄ‚îÄ Paper width preference (local storage) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const paperWidth = ref<PaperWidth>(getStoredPaperWidth());

const paperSizeOptions: { value: PaperWidth; label: string; desc: string }[] = [
  { value: '58mm', label: '58 mm', desc: ' Impresoras peque√±as' },
  { value: '80mm', label: '80 mm', desc: ' Est√°ndar (recomendado)' },
  { value: 'A4',   label: 'A4',    desc: ' Impresora de escritorio' },
];

const onPaperWidthChange = () => {
  savePaperWidth(paperWidth.value);
};

// ‚îÄ‚îÄ Load store settings from backend ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
onMounted(async () => {
  const res = await apiClient.get<any>('/store/');
  if (res.success && res.data) {
    const d = res.data;
    settings.value.storeName      = d.store_name      ?? '';
    settings.value.currency       = d.currency_symbol ?? '$ MXN';
    settings.value.address        = d.address         ?? '';
    settings.value.phone          = d.phone           ?? '';
    settings.value.thankYouMessage = d.ticket_message ?? '';
    settings.value.logoUrl        = d.logo_url        ?? '';
  }
});

// ‚îÄ‚îÄ Logo file handling ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const onLogoFile = (e: Event) => {
  const file = (e.target as HTMLInputElement).files?.[0];
  if (!file) return;
  if (file.size > 2 * 1024 * 1024) {
    enqueueSnackbar({ type: 'error', title: 'Archivo muy grande', message: 'El logo no debe superar 2 MB.', duration: 3000 });
    return;
  }
  logoFile.value = file;
  // Immediate local preview
  settings.value.logoUrl = URL.createObjectURL(file);
};

const onLogoDrop = (e: DragEvent) => {
  const file = e.dataTransfer?.files?.[0];
  if (!file || !file.type.startsWith('image/')) return;
  if (file.size > 2 * 1024 * 1024) {
    enqueueSnackbar({ type: 'error', title: 'Archivo muy grande', message: 'El logo no debe superar 2 MB.', duration: 3000 });
    return;
  }
  logoFile.value = file;
  settings.value.logoUrl = URL.createObjectURL(file);
};

// ‚îÄ‚îÄ Format address for ticket preview ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const formattedAddressLines = computed(() => {
  if (!settings.value.address) return [];
  const parts = settings.value.address.split(',');
  if (parts.length <= 2) return [settings.value.address];
  const line1 = parts.slice(0, 2).join(',').trim();
  const line2 = parts.slice(2).join(',').trim();
  return [line1, line2];
});

// ‚îÄ‚îÄ Save to backend ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const isSaving = ref(false);

const saveSettings = async () => {
  isSaving.value = true;
  try {
    const formData = new FormData();
    formData.append('store_name',      settings.value.storeName);
    formData.append('currency_symbol', settings.value.currency);
    formData.append('address',         settings.value.address);
    formData.append('phone',           settings.value.phone);
    formData.append('ticket_message',  settings.value.thankYouMessage);

    if (logoFile.value) {
      formData.append('logo_file', logoFile.value);
    }

    const res = await apiClient.patch<any>('/store/1/', formData);

    if (res.success && res.data) {
      // Update logo URL with Cloudinary's final URL
      if (res.data.logo_url) {
        settings.value.logoUrl = res.data.logo_url;
        logoFile.value = null; // already uploaded
      }
      enqueueSnackbar({
        type: 'success',
        title: 'Configuraci√≥n Guardada',
        message: 'Los ajustes del negocio se guardaron correctamente.',
        duration: 3500,
      });
    } else {
      enqueueSnackbar({
        type: 'error',
        title: 'Error al guardar',
        message: res.error || 'No se pudo guardar la configuraci√≥n.',
        duration: 4000,
      });
    }
  } catch (err) {
    enqueueSnackbar({ type: 'error', title: 'Error', message: 'Error de conexi√≥n al servidor.', duration: 3000 });
  } finally {
    isSaving.value = false;
  }
};
</script>

<style scoped>
.settings-wrapper {
  flex: 1;
  overflow-y: auto;
  height: 100%;
}

.settings-spinner {
  width: 16px;
  height: 16px;
  border: 2px solid rgba(255,255,255,0.35);
  border-top-color: #fff;
  border-radius: 50%;
  animation: spin 0.6s linear infinite;
  display: inline-block;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.settings-inner {
  background: var(--color-card-stats-fill);
  max-width: 100%;
  min-height: 100vh;
  margin: 0 auto;
  padding: 1.75rem 2rem;
}

/* Page Header */
.page-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 2rem;
  flex-wrap: wrap;
  gap: 1rem;
}

.page-title {
  font-size: 1.875rem;
  font-weight: 800;
  color: #111827;
  letter-spacing: -0.5px;
  margin: 0;
}

.page-subtitle {
  color: #6B7280;
  margin-top: 0.25rem;
  font-size: 0.95rem;
  max-width: 600px;
}

/* Base button from Nurax styles */
.btn-action {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.75rem 1.25rem;
  border-radius: 12px;
  font-weight: 600;
  font-size: 0.95rem;
  cursor: pointer;
  transition: all 0.2s;
  border: none;
}

.btn-action svg {
  width: 20px;
  height: 20px;
}

.btn-action.primary {
  background: var(--color-status-success, #22c55e); 
  /* Alternatively brand color, but mockup is vivid green */
  color: white;
  box-shadow: 0 4px 6px -1px rgba(34, 197, 94, 0.2);
}

.btn-action.primary:hover {
  background: #16a34a;
  transform: translateY(-1px);
  box-shadow: 0 6px 10px -3px rgba(34, 197, 94, 0.3);
}

/* Main Grid Template */
.settings-grid {
  display: grid;
  grid-template-columns: 1fr 380px;
  gap: 2rem;
  align-items: start;
}

@media (max-width: 1024px) {
  .settings-grid {
    grid-template-columns: 1fr;
  }
}

/* LEFT COLUMN - Forms */
.settings-forms {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}

.settings-card {
  background: #fff;
  border-radius: 20px;
  padding: 1.75rem 2rem;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
}

.card-header {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  margin-bottom: 1.5rem;
}

.icon-box {
  width: 38px;
  height: 38px;
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.icon-box.brand {
  color: var(--color-brand-main);
  background: rgba(34, 125, 82, 0.1); /* light matching green */
}

.icon-box svg {
  width: 22px;
  height: 22px;
}

.card-header h2 {
  font-size: 1.2rem;
  font-weight: 700;
  color: #111827;
  margin: 0;
}

.form-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1.5rem;
}

.input-group.full-width {
  grid-column: span 2;
}

.input-group label {
  display: block;
  font-size: 0.85rem;
  font-weight: 600;
  color: #111827;
  margin-bottom: 0.5rem;
}

/* Inputs / Selects styling */
.input-with-icon {
  position: relative;
  display: flex;
  align-items: center;
}

.input-with-icon input {
  width: 100%;
  padding: 0.875rem 1rem;
  background: #f9fafb;
  border: 1px solid transparent;
  border-radius: 30px;
  font-size: 0.95rem;
  color: #374151;
  font-family: inherit;
  transition: all 0.2s;
  outline: none;
}

.input-with-icon input:focus {
  background: white;
  border-color: var(--color-brand-main);
  box-shadow: 0 0 0 3px rgba(34, 125, 82, 0.1);
}

.input-with-icon.right input {
  padding-right: 2.5rem;
}

.input-with-icon.left input {
  padding-left: 2.75rem;
}

.input-with-icon .icon {
  position: absolute;
  color: #9ca3af;
  width: 20px;
  height: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.input-with-icon.right .icon {
  right: 1rem;
}

.input-with-icon.left .icon {
  left: 1rem;
}

.select-wrapper {
  position: relative;
}

.select-wrapper select {
  width: 100%;
  appearance: none;
  padding: 0.875rem 2.5rem 0.875rem 1rem;
  background: #f9fafb;
  border: 1px solid transparent;
  border-radius: 30px;
  font-size: 0.95rem;
  color: #374151;
  font-family: inherit;
  cursor: pointer;
  transition: all 0.2s;
  outline: none;
}

.select-wrapper select:focus {
  background: white;
  border-color: var(--color-brand-main);
  box-shadow: 0 0 0 3px rgba(34, 125, 82, 0.1);
}

.select-wrapper .chevron {
  position: absolute;
  right: 1rem;
  top: 50%;
  transform: translateY(-50%);
  width: 16px;
  height: 16px;
  color: #9ca3af;
  pointer-events: none;
}

/* Phone Layout */
.phone-input-group {
  display: grid;
  grid-template-columns: 100px 1fr;
  gap: 0.5rem;
}

/* Textarea */
textarea {
  width: 100%;
  padding: 0.875rem 1rem;
  background: #f9fafb;
  border: 1px solid transparent;
  border-radius: 16px;
  font-size: 0.95rem;
  color: #374151;
  font-family: inherit;
  resize: vertical;
  transition: all 0.2s;
  outline: none;
  line-height: 1.5;
}

textarea:focus {
  background: white;
  border-color: var(--color-brand-main);
  box-shadow: 0 0 0 3px rgba(34, 125, 82, 0.1);
}

/* Dropzone */
.dropzone {
  width: 100%;
  height: 120px;
  border: 2px dashed #d1d5db;
  border-radius: 16px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background: #fff;
  cursor: pointer;
  transition: all 0.2s;
  position: relative;
  overflow: hidden;
}

.dropzone:hover {
  border-color: var(--color-brand-main);
  background: #f8faf9;
}

.dropzone-has-image {
  border-style: solid;
  border-color: var(--color-brand-main);
  background: #f0faf5;
}

.dropzone-icon {
  width: 36px;
  height: 36px;
  background: rgba(34, 125, 82, 0.1);
  color: var(--color-brand-main);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-bottom: 0.5rem;
}

.dropzone-icon svg {
  width: 20px;
  height: 20px;
}

.dropzone-preview {
  max-height: 90px;
  max-width: 100%;
  object-fit: contain;
  border-radius: 8px;
}

.dropzone-remove {
  position: absolute;
  top: 6px;
  right: 6px;
  width: 24px;
  height: 24px;
  background: rgba(0,0,0,0.5);
  color: white;
  border: none;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: background 0.15s;
  padding: 0;
}

.dropzone-remove:hover {
  background: rgba(220, 38, 38, 0.8);
}

.dropzone-remove svg {
  width: 14px;
  height: 14px;
}

.dropzone-text {
  font-size: 0.875rem;
  font-weight: 600;
  color: #374151;
  margin: 0;
}

.dropzone-hint {
  font-size: 0.75rem;
  color: #9ca3af;
  margin-top: 0.25rem;
}

@media (max-width: 640px) {
  .form-grid {
    grid-template-columns: 1fr;
  }
  .input-group {
    grid-column: span 2;
  }
}

/* RIGHT COLUMN - Preview */
.preview-card {
  background: #fff;
  border-radius: 20px;
  padding: 1.5rem;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
  display: flex;
  flex-direction: column;
}

.preview-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 1.5rem;
}

.preview-title {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-weight: 700;
  font-size: 1.1rem;
  color: #111827;
}

.preview-title svg {
  width: 24px;
  height: 24px;
}

.preview-badge {
  background: #f3f4f6;
  color: #4b5563;
  font-size: 0.7rem;
  font-weight: 700;
  letter-spacing: 1px;
  padding: 0.25rem 0.6rem;
  border-radius: 12px;
}

/* Ticket Simulation Styles */
.ticket-simulation {
  background: #ffffff;
  border: 1px solid #e5e7eb;
  border-radius: 8px;
  padding: 1.5rem;
  box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05), 0 8px 10px -6px rgba(0, 0, 0, 0.01);
  font-family: inherit;
  margin-bottom: 1.5rem;
}

.ticket-header {
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
  margin-bottom: 1rem;
}

.ticket-logo {
  width: 56px;
  height: 56px;
  background: #111827;
  color: white;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5rem;
  font-weight: 700;
  margin-bottom: 0.75rem;
  overflow: hidden;
  flex-shrink: 0;
}

.ticket-logo-img {
  background: transparent;
}

.ticket-logo img {
  width: 100%;
  height: 100%;
  object-fit: contain;
}

.ticket-store-name {
  font-size: 1.15rem;
  font-weight: 800;
  color: #111827;
  margin: 0 0 0.25rem 0;
}

.ticket-address {
  font-size: 0.75rem;
  color: #6b7280;
  line-height: 1.4;
}

.ticket-divider {
  border-top: 1px dashed #d1d5db;
  margin: 1rem 0;
}

.ticket-table {
  font-size: 0.75rem;
  color: #4b5563;
}

.ticket-th {
  display: flex;
  justify-content: space-between;
  text-transform: uppercase;
  font-weight: 700;
  color: #9ca3af;
  margin-bottom: 0.5rem;
}

.ticket-tr {
  display: flex;
  justify-content: space-between;
  margin-bottom: 0.4rem;
}

.left-col {
  flex: 1;
  padding-right: 1rem;
}

.right-col {
  font-weight: 500;
}

.ticket-total-section {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
}

.ticket-total-row {
  display: flex;
  justify-content: space-between;
  font-size: 1.15rem;
  font-weight: 800;
  color: #111827;
  margin-bottom: 0.25rem;
}

.ticket-subInfo {
  display: flex;
  justify-content: space-between;
  font-size: 0.75rem;
  color: #6b7280;
}

.ticket-footer {
  text-align: center;
  margin-top: 1.5rem;
}

.ticket-thank-you {
  font-size: 0.85rem;
  font-style: italic;
  color: #374151;
  margin-bottom: 0.5rem;
  white-space: pre-line;
}

.ticket-number {
  font-size: 0.7rem;
  color: #9ca3af;
  letter-spacing: 0.5px;
  text-transform: uppercase;
  margin-bottom: 1rem;
}

.ticket-barcode {
  width: 140px;
  height: 35px;
  margin: 0 auto;
  opacity: 0.2;
}

.preview-footer-note {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.35rem;
  font-size: 0.75rem;
  color: #9ca3af;
}

.preview-footer-note svg {
  width: 14px;
  height: 14px;
}

.home-icon-style{
  width: 24px;
  height: 24px;
}

.pencil-icon-style{
  width: 24px;
  height: 24px;
}

.tion-icon-style{
  width: 24px;
  height: 24px;
}

/* ‚îÄ‚îÄ Paper size selector ‚îÄ‚îÄ */
.paper-size-options {
  display: flex;
  gap: 0.75rem;
  flex-wrap: wrap;
}

.paper-size-btn {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.25rem;
  padding: 0.875rem 1.25rem;
  border: 1.5px solid #E5E7EB;
  border-radius: 12px;
  cursor: pointer;
  background: #F9FAFB;
  transition: all 0.2s;
  min-width: 90px;
  text-align: center;
  user-select: none;
}

.paper-size-btn:hover {
  border-color: var(--color-brand-main, #06402B);
  background: rgba(6, 64, 43, 0.04);
}

.paper-size-btn.selected {
  border-color: var(--color-brand-main, #06402B);
  background: rgba(6, 64, 43, 0.08);
  box-shadow: 0 0 0 3px rgba(6, 64, 43, 0.1);
}

.paper-icon {
  font-size: 1.4rem;
}

.paper-label {
  font-size: 0.85rem;
  font-weight: 700;
  color: #111827;
}

.paper-desc {
  font-size: 0.7rem;
  color: #6B7280;
  line-height: 1.2;
}

</style>
